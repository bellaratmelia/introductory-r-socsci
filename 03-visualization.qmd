---
title: "Data Visualization and Descriptive Stats"
author: "Bella Ratmelia"
format: revealjs
---

## Today's Outline

1.  Descriptive Statistics
2.  Data Visualization in ggplot using World Values Survey data, including guidelines on how to choose the appropriate visualization.

## Checklist when you start RStudio

-   Load the project we created last session and open the R script file.
-   Make sure that `Environment` panel is empty (click on broom icon to clean it up)
-   Clear the `Console` and `Plots` too.
-   Re-run the `library(tidyverse)` and `read_csv` portion in the previous session

## Refresher: Loading from CSV into a dataframe

Use `read_csv` from `readr` package (part of `tidyverse`) to load our data into a dataframe

```{r}
#| echo: true
#| label: load-data
#| message: false
#| output: false

# import tidyverse library
library(tidyverse)

# read the CSV with WVS data
wvs_data <- read_csv("data-output/wvs_processed.csv")

# Convert categorical variables to factors
wvs_data <- wvs_data |> 
    mutate(across(c("country", "sex", "marital_status", "employment", "religiousity"), as.factor))

# peek at the data, pay attention to the data types!
glimpse(wvs_data)
```

## Basic R Functions for Descriptive Statistics

Descriptive statistics provide summaries about the sample and observations made. These summaries can be quantitative (summary statistics) or visual (graphs).

Let's explore some basic R functions for descriptive statistics using our Chile voting data.

-   `mean()`: arithmetic average
-   `median()`: middle value
-   `sd()`: standard deviation
-   `var()`: variance
-   `range()`: range of values
-   `IQR()`: interquartile range
-   `summary()`: provides a summary of descriptive statistics
-   `Mode()` function from `DescTools` package: the most frequently occuring value [^1]

[^1]: R doesn't have built-in functions for mode, so we need `DescTools` package to get this function

## Exploring Age Distribution

Let's start by examining the `age` variable in our dataset.

```{r}
#| echo: true
#| output-location: slide

library(DescTools)

# Basic statistics
mean_age <- mean(wvs_data$age, na.rm = TRUE)
median_age <- median(wvs_data$age, na.rm = TRUE)
sd_age <- sd(wvs_data$age, na.rm = TRUE)
range_age <- range(wvs_data$age, na.rm = TRUE)
iqr_age <- IQR(wvs_data$age, na.rm = TRUE)
mode_age <- DescTools::Mode(wvs_data$age, na.rm = TRUE)

# Print results
cat("Mean age:", mean_age, "\n")
cat("Median age:", median_age, "\n")
cat("Standard deviation of age:", sd_age, "\n")
cat("Range of age:", range_age[1], "to", range_age[2], "\n")
cat("Interquartile range of age:", iqr_age, "\n")
cat("Most frequently occuring age:", mode_age, "\n")

# Summary statistics
summary(wvs_data$age)
```

## Interpreting Age Statistics

Some possible interpretation:

-   The mean (47.99) and median (48) are very close, suggesting a fairly symmetric distribution

-   The mode (54) is slightly higher than both mean and median

-   With SD = 16.74, about two-thirds of participants fall between 31.26 and 64.72 years old (mean Â± 1 SD)

-   The distribution spans from 18 to 93 years, with an interquartile range of 28 years

It's much easier if we have a graph to visualize these interpretations!

## Visualizing data with ggplot

-   `ggplot` is plotting package that is included inside `tidyverse` package

-   works best with data in the long format, i.e., a column for all the dimensions/measures and another column for the value for each dimension/measure.

```{r}
#| echo: true
#| output-location: slide
wvs_data |> 
    ggplot(aes(x = age)) +
    geom_bar(fill = "lightblue") +
    labs(title = "Age distribution of respondents",
         x = "Age",
         y = "Number of Respondents") +
    theme_minimal()
```

## Anatomy of ggplot code

Charts built with ggplot must include the following:

``` {.r code-line-numbers="|1|2|3|4-6|7"}
wvs_data |> # <1>
    ggplot(aes(x = age)) + # <2>
    geom_bar(fill = "lightblue") + # <3>
    labs(title = "Age distribution of respondents", # <4>
         x = "Age", # <4>
         y = "Count") + # <4>
    theme_minimal() # <5>
```

1.  **Data** - the dataframe/tibble to visualize.

2.  **Aesthetic mappings (aes)** - describes which variables are mapped to the x, y axes, alpha (transparency) and other visual aesthetics.

3.  **Geometric objects (geom)** - describes how values are rendered; as bars, scatterplot, lines, etc.

4.  Provide titles and labels to your graph

5.  (Optional) apply a theme/look to your graph

## Going back to our data

Our research team wants to understand patterns in life satisfaction and values across different countries and demographic groups. Let's create visualizations to address these questions:

1.  What's the distribution of `life_satisfaction` scores across all respondents?
2.  How does `religiousity` vary across the three countries?
3.  What's the distribution of `employment_status` by country?
4.  Is there a relationship between `political_scale` and `life_satisfaction`?
5.  How do `importance` ratings (family, friends, leisure, work) compare across `employment` status?
6.  Does `financial_satisfaction` correlate with `life satisfaction`? How does this vary by `country`?

## Tip: open the ggplot cheatsheet

::: callout-tip
**A strategy I'd like to recommend:** briefly read over the `ggplot2` documentation and have them open on a separate tab. Figure out the type of variables you need to visualize (discrete or continuous) to quickly identify which visualization would make sense.
:::

![](images/ggplot-cheatsheet.jpg){width="60%"}

[ggplot documentation link](https://rstudio.github.io/cheatsheets/html/data-visualization.html)

## Task #1

What's the distribution of `life_satisfaction` scores?

```{r}
#| echo: true
#| output-location: slide

# One continuous variable
wvs_data |> 
    ggplot(aes(x = life_satisfaction)) +
    geom_histogram(binwidth = 1, fill = "pink", color = "maroon") +
    labs(title = "Distribution of Life Satisfaction Scores",
       x = "Life Satisfaction (1-10)",
       y = "Count")
```

## Task #2

What's the distribution of `religiousity`? Does it vary by country?

```{r}
#| echo: true
#| output-location: slide

# One discrete/categorical variable
wvs_data |> 
    ggplot(aes(x = country, fill = religiousity)) +
    geom_bar(position = "fill") +
    labs(title = "Distribution of Religiosity Across Countries",
       x = "Country",
       y = "Proportion",
       fill = "Religious Identity") +
    theme_minimal()
```

## Task #3

What's the distribution of `employment_status` by country?

```{r}
#| echo: true
#| output-location: slide

# Showing proportions / percentage as part of whole
# Two categorical variables
wvs_data |> 
    ggplot(aes(x = country, fill = employment)) +
    geom_bar(position = "dodge") +
    labs(title = "Employment Status Distribution by Country",
       x = "Country",
       y = "Count") +
    theme_minimal()
```

## Group exercise #1 (solo attempts also ok)

Visualize marital status distribution by sex, showing the proportion for each gender.

```{r}
#| echo: true
#| output-location: slide
#| code-fold: true

wvs_data |>
    ggplot(aes(x = sex, fill = marital_status)) +
    geom_bar(position = "fill") + 
    labs(title = "Proportion of Marital Status by Gender",
       x = "Sex",
       y = "Proportion",
       fill = "Marital Status") +
    theme_minimal()
```

## Task #4

Is there a relationship between `political_scale` and `life_satisfaction`?

```{r}
#| echo: true
#| output-location: slide

# Two variables - both continuous
wvs_data |>
    ggplot(aes(x = political_scale, y = life_satisfaction)) +
    geom_jitter(alpha = 0.3) +
    geom_smooth(method = "lm", color = "red") +
    labs(title = "Political Leaning vs Life Satisfaction",
       x = "Political Leaning",
       y = "Life Satisfaction")
```

## Task #5

How do `religiousity` compare across `marital_status`?

```{r}
#| echo: true
#| output-location: slide

# Two categorical variables: marital status and religiosity
wvs_data |> 
    ggplot(aes(x = marital_status, fill = religiousity)) +
    geom_bar(position = "fill") +
    labs(title = "Religious Identity Distribution by Marital Status",
         x = "Marital Status",
         y = "Proportion",
         fill = "Religious Identity") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```


## Facets for multiple variables

```{r}
#| echo: true
#| output-location: slide

# Faceting and multiple variables
wvs_data |> 
    ggplot(aes(x = marital_status, fill = religiousity)) +
    geom_bar(position = "fill") +
    labs(title = "Religious Identity Distribution by Marital Status",
         x = "Marital Status",
         y = "Count",
         fill = "Religious Identity") +
    facet_grid( ~ country) +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Task #6

Does `financial_satisfaction` correlate with `life satisfaction`? How does this vary by `country`?

Let's layer two kinds of visualization here:

```{r}
#| echo: true
#| output-location: slide

# Two continuous variables with grouping
wvs_data |> 
    ggplot(aes(x = financial_satisfaction, y = life_satisfaction, color = country)) +
    geom_point(alpha = 0.3) +
    geom_smooth(method = "lm", se = FALSE) +
    facet_wrap(~ country) +
    labs(title = "Life Satisfaction vs Financial Satisfaction by Country",
       x = "Financial Satisfaction",
       y = "Life Satisfaction")
```

## Group Exercise #2

Create a violin plot showing the distribution of freedom scores by employment status, with points overlaid.

```{r}
#| echo: true
#| output-location: slide
#| code-fold: true

wvs_data |> 
    ggplot(aes(x = employment, y = freedom)) +
    geom_violin(fill = "lightblue") +
    geom_jitter(alpha = 0.2, color = "navy") + 
    labs(title = "Distribution of Freedom Scores by Employment Status",
       x = "Employment Status",
       y = "Freedom Score") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Group Exercise #3

Visualize the distribution of employment status across marital status categories, and use faceting to compare this relationship across countries.

```{r}
#| echo: true
#| output-location: slide
#| code-fold: true

wvs_data |> 
    ggplot(aes(x = marital_status, fill = employment)) +
    geom_bar(position = "fill") +
    facet_wrap(~ country) + 
    labs(title = "Employment Status Distribution by Marital Status and Country",
       x = "Marital Status",
       y = "Proportion",
       fill = "Employment Status") +
    theme_minimal() +
    theme(axis.text.x = element_text(angle = 45, hjust = 1))
```

## Is fancier = better?

Fancier, more complicated visualization does not necessarily mean better!

Take a look at this award-winning visualization by [Simon Scarr](http://www.simonscarr.com/iraqs-bloody-toll)

```{=html}
<iframe width="1500" height="600" src="http://www.simonscarr.com/iraqs-bloody-toll" title="Simon Scarr's visualization"></iframe>
```

## Strategy for data visualization with ggplot

1.  Have the ggplot documentation/cheatsheet open
2.  Decide on how many variables are involved. Is it just one? two? more than two?
3.  Determine whether the variables are categorical or continuous. If you have more than one, are they both categorical? one categorical + one continuous?
4.  Refer to the documentation to see which type of visualization would make sense for your variables.

# End of Session 3!

Check out the [R Graph gallery](https://r-graph-gallery.com/) for inspiration and code samples!

Next session: statistical tests in R using WVS data
